<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam Rogers (arogers24@amherst.edu)">
<meta name="dcterms.date" content="2024-03-15">

<title>STAT325 (Text Analytics) Moby-Dick Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="MobyDick-Report_files/libs/clipboard/clipboard.min.js"></script>
<script src="MobyDick-Report_files/libs/quarto-html/quarto.js"></script>
<script src="MobyDick-Report_files/libs/quarto-html/popper.min.js"></script>
<script src="MobyDick-Report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="MobyDick-Report_files/libs/quarto-html/anchor.min.js"></script>
<link href="MobyDick-Report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MobyDick-Report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="MobyDick-Report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="MobyDick-Report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="MobyDick-Report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="MobyDick-Report_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="MobyDick-Report_files/libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="MobyDick-Report_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="MobyDick-Report_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="MobyDick-Report_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="MobyDick-Report_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="MobyDick-Report_files/libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="MobyDick-Report_files/libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT325 (Text Analytics) Moby-Dick Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adam Rogers (arogers24@amherst.edu) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-03-15</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="background" class="level1">
<h1>Background</h1>
<p>Herman Melville’s <em>Moby-Dick</em> <span class="citation" data-cites="melville1851moby">(<a href="#ref-melville1851moby" role="doc-biblioref">Melville 1851</a>)</span> is an unparalleled masterpiece in American literature, a work that combines deep philosophical inquiry with a compelling narrative of adventure and obsession. Initially met with mixed reviews and modest success upon its publication in 1851, the novel’s true brilliance was not universally recognized until well after Melville’s death. This posthumous recognition marks <em>Moby-Dick</em> as a seminal work, a testament to Melville’s genius, which only time could unveil.</p>
<p>Melville’s magnum opus is distinguished not only by its ambitious themes and complex characters but also by its striking variation in literary style. <em>Moby-Dick</em> oscillates between narrative storytelling, centered around the perilous journey of the Pequod and its diverse crew, and expansive expository sections that delve into the intricacies of whaling life and maritime culture. This stylistic duality reflects Melville’s personal experiences aboard a whaling vessel, infusing the narrative with authenticity and a palpable sense of the sea and its perils. In one of the earliest and most renowned critiques of <em>Moby-Dick,</em> Walter Bezanson highlights the public’s interest in <em>Moby-Dick</em> as “direct narrative, as moral analogue, as modern source, and as spiritual autobiography.”<span class="citation" data-cites="hillway1953essays">(<a href="#ref-hillway1953essays" role="doc-biblioref">Hillway and Mansfield 1953</a>)</span></p>
<p>The novel’s narrative voice is another aspect of its complexity. While the story is ostensibly told through the eyes of Ishmael, a reflective and observant sailor, there are times when the narrative transcends his perspective. In many of the descriptive passages about whale anatomy, ship construction, and the philosophical underpinnings of whaling, the voice seems to shift from Ishmael to Melville himself. This transition suggests a blurring of lines between narrator and author, providing a window into Melville’s own reflections and insights drawn from his time at sea.</p>
<p>The fluctuation between the detailed, almost encyclopedic exposition and the dynamic, character-driven narrative segments underscores the novel’s thematic depth and complexity. It is this blend of narrative styles, driven by Melville’s firsthand maritime experiences, that enriches <em>Moby-Dick</em> with its unique literary texture. The novel invites readers into a world where the boundaries between adventure narrative and meditative discourse are seamlessly intertwined.</p>
<p>This work aims to explore the intricate relationships between parts of speech and literary styles within <em>Moby-Dick,</em> facilitated by a Shiny App designed to allow users to navigate through the text seamlessly. By examining the stylistic shifts between Ishmael’s storytelling and Melville’s authoritative discourses, we seek to understand how these changes in narrative voice and style contribute to the novel’s profound impact and lasting legacy in the landscape of American literature.</p>
</section>
<section id="wrangling" class="level1">
<h1>Wrangling</h1>
<p>Literary scholars often assert that <em>Moby-Dick</em> contains diverse writing styles. However, substantiating this assertion with textual data prompts the question: what tangible evidence can we derive from the text to confirm this diversity? The segments that provide encyclopedic knowledge about whaling span a plethora of subjects. Melville’s vivid descriptions range from various whale species and the critical role of the harpooner to the depictions of whales in art, the intricacies of blubber, the ship’s components, whale anatomy, and other elements encapsulating the art and essence of whaling. While as readers we can discern these expository chapters from the narrative ones by virtue of literary flow, as data scientists, we must delve into identifying the distinct attributes of these divergent writing styles.</p>
<p>I posit that analyzing the frequency of various parts of speech could demarcate the descriptive chapters from the narrative ones. For instance, it stands to reason that chapters with more proper nouns likely delve more into character interactions and dialogues, given their portrayal of the Pequod’s crew, encounters with different characters, and visits to new locations. Similarly, narrative chapters are expected to feature a higher verb count, resonating with the active engagement and interaction of characters.</p>
<p>To validate these hypotheses, we can extract the text of <em>Moby-Dick</em> from Project Gutenberg <span class="citation" data-cites="ProjectGutenberg">(<a href="#ref-ProjectGutenberg" role="doc-biblioref">ProjectGutenberg 2001</a>)</span> to create a data package. We then leverage the ‘cleanNLP’ package to parse the text of <em>Moby-Dick,</em> focusing on identifying parts of speech and named entities, such as “Person” and “Location.” For this case, we are interested in the parts of speech. This part of the function appears more accurate than the NER (named-entity recognition).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"wrangling/anno_moby.Rds"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(file_name))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(file_name)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>anno<span class="sc">$</span>entity[<span class="dv">7</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  doc_id   sid   tid tid_end entity_type entity           
   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;            
1     24     1     7       8 PERSON      Sabbath afternoon</code></pre>
</div>
</div>
<p>As you can see, NER recognizes the words “Sabbath afternoon” as a person, when it is a description of a time. Therefore, we will continue exploring parts of speech for our analysis. After loading and reading the <code>anno_moby.Rds</code> file, we can view the tokenized text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(anno<span class="sc">$</span>token)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  doc_id   sid   tid token   token_with_ws lemma upos  xpos  tid_source relation
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;   
1      1     1     1 CHAPTER "CHAPTER "    CHAP… PROPN NNP            3 compound
2      1     1     2 I.      "I. "         I.    PROPN NNP            3 compound
3      1     1     3 LOOMIN… "LOOMINGS"    LOOM… PROPN NNP            0 root    
4      2     1     1 Call    "Call "       call  VERB  VB             0 root    
5      2     1     2 me      "me "         I     PRON  PRP            1 dobj    
6      2     1     3 Ishmael "Ishmael"     Ishm… PROPN NNP            1 oprd    </code></pre>
</div>
</div>
<p>This annotation maps every word and symbol of punctuation to a part of speech. We are interested in the <code>upos</code> variable, which tells us this information.</p>
<p>Since we are interested in exploring the parts of speech in each chapter, we need to add that variable. To do this, we take a cumulative sum of the number of times we encounter “CHAPTER” and <code>tid</code> = 1. We add this additional conditional statement to avoid the edge case where “CHAPTER” is in the text, but does not indicate a new chapter. Notice how we see this in chapter 32, where new sub-chapters begin.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>chapter_example <span class="ot">&lt;-</span> anno<span class="sc">$</span>token <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((token <span class="sc">==</span> <span class="st">"CHAPTER"</span> <span class="sc">|</span> <span class="fu">lag</span>(token) <span class="sc">==</span> <span class="st">"CHAPTER"</span>) <span class="sc">&amp;</span> doc_id <span class="sc">&gt;=</span> <span class="dv">4164</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chapter_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  doc_id   sid   tid token   token_with_ws lemma upos  xpos  tid_source relation
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;   
1   4164     1     1 CHAPTER "CHAPTER "    chap… NOUN  NN             2 compound
2   4164     1     2 XXXII   "XXXII"       XXXII PROPN NNP            0 root    
3   4304     1     9 CHAPTER "CHAPTER "    CHAP… PROPN NNP           10 compound
4   4304     1    10 I.      "I. "         I.    PROPN NNP            2 appos   
5   4330     1     9 CHAPTER "CHAPTER "    chap… NOUN  NN            10 compound
6   4330     1    10 II      "II"          II    PROPN NNP            2 appos   </code></pre>
</div>
</div>
<p>For this case, we still want those sub-chapters to be included in chapter 32, so we must condition.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>token_with_chapters <span class="ot">&lt;-</span> anno<span class="sc">$</span>token <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add chapter number to tokenized text</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use tid == 1 to avoid edge case where text "CHAPTER" is within a chapter</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter_number =</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">cumsum</span>(<span class="fu">str_detect</span>(token, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">regex</span>(<span class="st">"^CHAPTER"</span>, <span class="at">ignore_case =</span> <span class="cn">FALSE</span>)) <span class="sc">&amp;</span> tid <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(token_with_chapters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  doc_id   sid   tid token   token_with_ws lemma upos  xpos  tid_source relation
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;   
1      1     1     1 CHAPTER "CHAPTER "    CHAP… PROPN NNP            3 compound
2      1     1     2 I.      "I. "         I.    PROPN NNP            3 compound
3      1     1     3 LOOMIN… "LOOMINGS"    LOOM… PROPN NNP            0 root    
4      2     1     1 Call    "Call "       call  VERB  VB             0 root    
5      2     1     2 me      "me "         I     PRON  PRP            1 dobj    
6      2     1     3 Ishmael "Ishmael"     Ishm… PROPN NNP            1 oprd    
# ℹ 1 more variable: chapter_number &lt;int&gt;</code></pre>
</div>
</div>
<p>Subsequently, we aggregate relevant parts of speech per chapter from this tokenized text. This involves grouping the data by chapter, quantifying each part of speech, and determining their proportion relative to the chapter’s total word count:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>token_type_summary <span class="ot">&lt;-</span> token_with_chapters <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(chapter_number) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">n</span>(),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">NOUN_count =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(upos <span class="sc">==</span> <span class="st">"NOUN"</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">NOUN_prop =</span> NOUN_count<span class="sc">/</span>total,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">ADJ_count =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(upos <span class="sc">==</span> <span class="st">"ADJ"</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">ADJ_prop =</span> ADJ_count<span class="sc">/</span>total,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">VERB_count =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(upos <span class="sc">==</span> <span class="st">"VERB"</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">VERB_prop =</span> VERB_count<span class="sc">/</span>total,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">ADV_count =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(upos <span class="sc">==</span> <span class="st">"ADV"</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">ADV_prop =</span> ADV_count<span class="sc">/</span>total,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">PROPN_count =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(upos <span class="sc">==</span> <span class="st">"PROPN"</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">PROPN_prop =</span> PROPN_count<span class="sc">/</span>total,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">CONJ_count =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(upos <span class="sc">==</span> <span class="st">"CCONJ"</span> <span class="sc">|</span> upos <span class="sc">==</span> <span class="st">"SCONJ"</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">CONJ_prop =</span> CONJ_count<span class="sc">/</span>total,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">PRON_count =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(upos <span class="sc">==</span> <span class="st">"PRON"</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">PRON_prop =</span> PRON_count<span class="sc">/</span>total,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">PUNCT_count =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(upos <span class="sc">==</span> <span class="st">"PUNCT"</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">PUNCT_prop =</span> PUNCT_count<span class="sc">/</span>total,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(token_type_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 18
  chapter_number total NOUN_count NOUN_prop ADJ_count ADJ_prop VERB_count
           &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1              1  2583        447     0.173       163   0.0631        270
2              2  1691        253     0.150       123   0.0727        172
3              3  7045       1083     0.154       465   0.0660        825
4              4  1921        295     0.154       121   0.0630        242
5              5   886        152     0.172        69   0.0779         84
6              6   981        197     0.201        71   0.0724         92
# ℹ 11 more variables: VERB_prop &lt;dbl&gt;, ADV_count &lt;dbl&gt;, ADV_prop &lt;dbl&gt;,
#   PROPN_count &lt;dbl&gt;, PROPN_prop &lt;dbl&gt;, CONJ_count &lt;dbl&gt;, CONJ_prop &lt;dbl&gt;,
#   PRON_count &lt;dbl&gt;, PRON_prop &lt;dbl&gt;, PUNCT_count &lt;dbl&gt;, PUNCT_prop &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Then we can write this data to a CSV, which we will use in the Shiny App to explore our findings. Note that we save both the tokenized text with chapter numbers and the summary of totals and proportions per chapter. Both will be utilized in the UI of the Shiny App.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(token_with_chapters, <span class="st">"token_with_chapters.csv"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(token_type_summary, <span class="st">"token_type_summary.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By adhering to this approach, we illuminate the distinct narrative and descriptive textures within <em>Moby-Dick,</em> thereby advancing both literary analysis and computational text examination.</p>
</section>
<section id="shiny-app-exploration" class="level1">
<h1>Shiny App Exploration</h1>
<p>Users can delve into the data relationships on their own through the Shiny App, enabling them to inspect various plots and statistics regarding the usage of different parts of speech across chapters. This feature facilitates comparisons between the proportions of specific parts of speech per chapter, allowing for an in-depth exploration of potential correlations with the text’s content.</p>
<p>Upon accessing the Shiny App, users are greeted with options to select from parts of speech such as “Noun”, “Adjective”, “Verb”, “Adverb”, “Proper Noun”, “Conjunction”, “Pronoun”, and “Punctuation.” Following their selection, the app displays both a table and a plot.</p>
<p>The table lists chapter numbers alongside the total word count, the frequency of the chosen part of speech, and its chapter-wise proportion. By default, the plot orders these proportions in descending order, emphasizing the chapters where the selected part of speech is most prevalent.</p>
<p>We focus particularly on the proportions of verbs and proper nouns. Below is the R code segment that generates tables sorted by the descending proportion of these parts of speech:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating and displaying tables for verbs and proper nouns</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>verb_table <span class="ot">&lt;-</span> token_type_summary <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(chapter_number,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>             total,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>             VERB_count,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>             VERB_prop</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(VERB_prop))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>propn_table <span class="ot">&lt;-</span> token_type_summary <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(chapter_number,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>             total,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>             PROPN_count,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>             PROPN_prop</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">|&gt;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(PROPN_prop))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(verb_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  chapter_number total VERB_count VERB_prop
           &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1             37   670         92     0.137
2             21  1434        193     0.135
3             73  2674        347     0.130
4             19  1584        200     0.126
5             18  1745        220     0.126
6              4  1921        242     0.126</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(propn_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  chapter_number total PROPN_count PROPN_prop
           &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt;
1             83   916          81     0.0884
2             18  1745         132     0.0756
3             39   365          27     0.0740
4             32  6253         459     0.0734
5             40  2213         160     0.0723
6            125  1479          99     0.0669</code></pre>
</div>
</div>
<p>Below the table lies a plot generated by the <code>plotly</code> package. The x- and y-axes of the plot are the chapter number and proportion of selected part of speech. We can display the plots for verbs and proper nouns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>verb_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> token_type_summary,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> <span class="sc">~</span>chapter_number,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="sc">~</span>VERB_prop,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mode=</span> <span class="st">'markers'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>verb_plot <span class="ot">&lt;-</span> <span class="fu">layout</span>(verb_plot,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">title =</span> <span class="st">'Proportion of Parts of Speech by Chapter'</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Chapter Number"</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Proportion of Verb'</span>))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>verb_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-2578119514fed6b9f173" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2578119514fed6b9f173">{"x":{"visdat":{"939c76fc24c":["function () ","plotlyVisDat"]},"cur_data":"939c76fc24c","attrs":{"939c76fc24c":{"x":{},"y":{},"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Proportion of Parts of Speech by Chapter","xaxis":{"domain":[0,1],"automargin":true,"title":"Chapter Number"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Proportion of Verb"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135],"y":[0.104529616724739,0.101714961561206,0.117104329311568,0.12597605413847,0.0948081264108352,0.0937818552497452,0.100452488687783,0.0983754512635379,0.109196740395809,0.121464226289517,0.105072463768116,0.118725868725869,0.124634858812074,0.113738738738739,0.116391184573003,0.107633249667799,0.124419020378977,0.126074498567335,0.126262626262626,0.0974930362116992,0.134588563458856,0.1002457002457,0.105263157894737,0.0856849666495639,0.087719298245614,0.0890883977900552,0.0878618588115795,0.0990881458966565,0.115155526141628,0.112068965517241,0.121134020618557,0.082040620502159,0.0773966578715919,0.0954545454545455,0.0882447665056361,0.117222222222222,0.137313432835821,0.123983739837398,0.120547945205479,0.111613194758247,0.092964824120603,0.0885503451559153,0.102870813397129,0.0954182429592266,0.0917296901683337,0.0993788819875776,0.11,0.114587650227932,0.10261569416499,0.100854700854701,0.112921348314607,0.103694874851013,0.0946502057613169,0.110005130836326,0.0868385345997286,0.0775295663600526,0.0833333333333333,0.0922541340295909,0.112338858195212,0.0915451895043732,0.114201432785504,0.0980091883614089,0.0966010733452594,0.118081180811808,0.0891003460207613,0.0935828877005348,0.110458284371328,0.0759943181818182,0.102713178294574,0.105263157894737,0.116228070175439,0.109774436090226,0.129768137621541,0.0822981366459627,0.0872801082543978,0.0825049701789264,0.0876010781671159,0.112130479102956,0.0826521344232516,0.0840579710144927,0.106415381686655,0.0908413998510797,0.0873362445414847,0.114375655823715,0.0968280467445743,0.0942951438000943,0.110789283128168,0.0933908045977011,0.0779298036882808,0.0875796178343949,0.117984693877551,0.0858143607705779,0.0946564885496183,0.0969656992084433,0.0916808149405773,0.0951717734447539,0.0790378006872852,0.102291325695581,0.111396468699839,0.110332749562172,0.0775047258979206,0.101649813730708,0.0888278388278388,0.100779844031194,0.077007099945385,0.0883678990081154,0.0913385826771654,0.113669064748201,0.108412836079792,0.113543599257885,0.110671936758893,0.10507880910683,0.100376411543287,0.0957854406130268,0.113155473781049,0.108490566037736,0.109028960817717,0.104587155963303,0.110900473933649,0.116731517509728,0.117206982543641,0.0886075949367089,0.107889413351315,0.108516483516484,0.116970926301555,0.113901869158879,0.0975609756097561,0.118329466357309,0.116644823066841,0.108771929824561,0.123616236162362,0.103123450669311,0.115978787180078,0.10818858560794,0.114845465293025],"mode":"markers","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>propn_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> token_type_summary,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> <span class="sc">~</span>chapter_number,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="sc">~</span>PROPN_prop,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mode=</span> <span class="st">'markers'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>propn_plot <span class="ot">&lt;-</span> <span class="fu">layout</span>(propn_plot,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">title =</span> <span class="st">'Proportion of Parts of Speech by Chapter'</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Chapter Number"</span>),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Proportion of Proper Nouns'</span>))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>propn_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-a258cbffc39b9d2dcda2" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-a258cbffc39b9d2dcda2">{"x":{"visdat":{"939c3a3d0f64":["function () ","plotlyVisDat"]},"cur_data":"939c3a3d0f64","attrs":{"939c3a3d0f64":{"x":{},"y":{},"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Proportion of Parts of Speech by Chapter","xaxis":{"domain":[0,1],"automargin":true,"title":"Chapter Number"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Proportion of Proper Nouns"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135],"y":[0.0209059233449477,0.0514488468361916,0.020014194464159,0.013014055179594,0.0248306997742664,0.0662589194699287,0.0606334841628959,0.0306859205776173,0.0449359720605355,0.0249584026622296,0.00845410628019324,0.0415057915057915,0.0370009737098345,0.0427927927927928,0.0516528925619835,0.0478369998523549,0.0307472291741151,0.0756446991404011,0.0347222222222222,0.0324976787372331,0.0348675034867503,0.0574938574938575,0.0394736842105263,0.0446382760389944,0.0175438596491228,0.0269337016574586,0.0462163534789233,0.0346504559270517,0.0311052283256122,0.0344827586206897,0.0472508591065292,0.073404765712458,0.0360598065083553,0.0420454545454545,0.0322061191626409,0.05,0.0313432835820895,0.0284552845528455,0.073972602739726,0.0723000451875282,0.0356327089995432,0.0366579385860509,0.0526315789473684,0.0340479192938209,0.0397657965357404,0.0372670807453416,0.0336363636363636,0.0335681723995027,0.0301810865191147,0.0282051282051282,0.0292134831460674,0.032181168057211,0.029320987654321,0.036326321190354,0.0542740841248304,0.0486202365308804,0.0482456140350877,0.0217580504786771,0.0395948434622468,0.0087463556851312,0.0362410450906026,0.0107197549770291,0.00536672629695885,0.040590405904059,0.0346020761245675,0.0347593582887701,0.0152761457109283,0.0213068181818182,0.0290697674418605,0.0334928229665072,0.0508040935672515,0.0330827067669173,0.0351533283470456,0.0170807453416149,0.0358592692828146,0.0268389662027833,0.0336927223719677,0.0316004077471967,0.0526793823796549,0.0183574879227053,0.0336950314106225,0.0618019359642591,0.0884279475982533,0.0220356768100735,0.0171118530884808,0.0174446016030174,0.0289645184648805,0.0366379310344828,0.0511600237953599,0.0621019108280255,0.0433673469387755,0.0464098073555166,0.043765903307888,0.016490765171504,0.033955857385399,0.0227483751160631,0.0206185567010309,0.016366612111293,0.0507223113964687,0.0434909515469936,0.0552930056710775,0.0425758382118148,0.0192307692307692,0.0599880023995201,0.0469688694702348,0.036068530207394,0.0133858267716535,0.0479616306954436,0.0598438855160451,0.0296846011131725,0.0494071146245059,0.0306479859894921,0.0614805520702635,0.0217113665389527,0.0331186752529899,0.0345911949685535,0.0340715502555366,0.0431192660550459,0.0464454976303318,0.066147859922179,0.0324189526184539,0.0253164556962025,0.0404585300067431,0.0343406593406593,0.0669371196754564,0.0233644859813084,0.0386178861788618,0.0348027842227378,0.0615989515072084,0.0300751879699248,0.0479704797047971,0.0391670798215171,0.0378141572515564,0.0354838709677419,0.033946968417497],"mode":"markers","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Within the app, the plot points are interactive: hovering over a point reveals the chapter number and its corresponding proportion of the selected part of speech. Clicking on a point displays the text from the respective chapter, highlighting occurrences of the chosen part of speech in bold.</p>
<p>The text is generated from the tokenized text with associated chapter numbers. Our goal is to produce this text in paragraph form. First, we need to annotate the text. We do this with the <code>mutate()</code> function by rewriting the <code>token</code> variable as either an annotated version of that token or the token itself, depending on whether the part of speech matches our desired part of speech. We annotate using the HTML technique of padding the front and back with <code>&lt;b&gt;</code> and <code>&lt;\b&gt;</code>, respectively. Then we would like to paste the text together. Our initial thought is to add a space after every word and paste them together. This, however, ignores the case of punctuations, which immediately follow words. Thus, we must create two new variables. First, we create a variable for a space after each word called <code>space_after</code>. If the next word is a punctuation, we do not add a space. Then we paste the word and the <code>space_after</code> to get the <code>word_with_space</code>. Then we paste the words together to get a sentence, and then paste the sentences together to get paragraphs.</p>
<p>We particularly examine chapters with notably high or low occurrences of the selected parts of speech to discern more about their relationship with the narrative style. For instance, chapters 37 and 21, which are rich in verbs, offer insights into character interactions aboard the Pequod.</p>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>annotated_37 <span class="ot">&lt;-</span> token_with_chapters <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get chapter by number</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(chapter_number <span class="sc">==</span> <span class="dv">37</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add bold to specified part of speech</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">token =</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">if_else</span>(upos <span class="sc">==</span> <span class="st">"VERB"</span>, </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">paste0</span>(<span class="st">"&lt;b&gt;"</span>, token, <span class="st">"&lt;/b&gt;"</span>), token)) <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(doc_id, sid, tid) <span class="sc">|&gt;</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(doc_id, sid) <span class="sc">|&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add spaces after words, but not when next token is punctuation</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">space_after =</span> <span class="fu">ifelse</span>(<span class="fu">lead</span>(upos, <span class="at">default =</span> <span class="st">" "</span>) <span class="sc">==</span> <span class="st">"PUNCT"</span>, </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">""</span>, <span class="st">" "</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">word_with_space =</span> <span class="fu">paste</span>(token, space_after, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Combine words to sentence</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">sentence =</span> <span class="fu">paste</span>(word_with_space, <span class="at">collapse =</span> <span class="st">""</span>), </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(doc_id) <span class="sc">|&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Combine sentences to paragraphs</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">paragraph =</span> <span class="fu">paste</span>(sentence, <span class="at">collapse =</span> <span class="st">" "</span>), </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="fu">HTML</span>(annotated_37<span class="sc">$</span>paragraph[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p>CHAPTER XXXVII.  SUNSET  _  The cabin; by the stern windows; Ahab <b>sitting</b> alone, and <b>gazing</b> out._  I <b>leave</b> a white and turbid wake; pale waters, paler cheeks, where’er  I  <b>sail</b>.  The envious <b>billows</b> sidelong swell to <b>whelm</b> my track; <b>let</b> them;  but first I <b>pass</b>.  Yonder, by the ever- <b>brimming</b> goblet ’s rim, the warm waves blush like  wine.  The gold brow <b>plumbs</b> the blue.  The diver sun— slow <b>dived</b> from  <b>noon,—goes</b> down; my soul <b>mounts</b> up!  she <b>wearies</b> with her endless hill.  Is, then, the crown too heavy that I <b>wear</b>?  This Iron Crown of Lombardy.  Yet is it bright with many a gem; I, the wearer, <b>see</b> not its far  flashings; but darkly <b>feel</b> that I <b>wear</b> that, that dazzlingly <b>confounds</b>.  ’ Tis iron— that I <b>know</b>— not gold.’  Tis split, too— that I <b>feel</b>; the jagged  edge <b>galls</b> me so, my brain <b>seems</b> to <b>beat</b> against the solid metal; aye,  steel skull, mine; the sort that <b>needs</b> no helmet in the most  brain- <b>battering</b> fight!  Dry heat upon my brow?  Oh ! time was, when as the sunrise nobly <b>spurred</b>  me, so the sunset <b>soothed</b>.  No more.  This lovely light, it <b>lights</b> not  me; all loveliness is anguish to me, since I can ne’er <b>enjoy</b>.  Gifted  with the high perception, I <b>lack</b> the low, <b>enjoying</b> power; <b>damned</b>, most  subtly and most malignantly!  <b>damned</b> in the midst of Paradise!  Good</p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>annotated_21 <span class="ot">&lt;-</span> token_with_chapters <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get chapter by number</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(chapter_number <span class="sc">==</span> <span class="dv">21</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add bold to specified part of speech</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">token =</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">if_else</span>(upos <span class="sc">==</span> <span class="st">"VERB"</span>, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">paste0</span>(<span class="st">"&lt;b&gt;"</span>, token, <span class="st">"&lt;/b&gt;"</span>), token)) <span class="sc">|&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(doc_id, sid, tid) <span class="sc">|&gt;</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(doc_id, sid) <span class="sc">|&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add spaces after words, but not when next token is punctuation</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">space_after =</span> <span class="fu">ifelse</span>(<span class="fu">lead</span>(upos, <span class="at">default =</span> <span class="st">" "</span>) <span class="sc">==</span> <span class="st">"PUNCT"</span>, </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">""</span>, <span class="st">" "</span>),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">word_with_space =</span> <span class="fu">paste</span>(token, space_after, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Combine words to sentence</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">sentence =</span> <span class="fu">paste</span>(word_with_space, <span class="at">collapse =</span> <span class="st">""</span>), </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(doc_id) <span class="sc">|&gt;</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Combine sentences to paragraphs</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">paragraph =</span> <span class="fu">paste</span>(sentence, <span class="at">collapse =</span> <span class="st">" "</span>), </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="fu">HTML</span>(annotated_21<span class="sc">$</span>paragraph[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p>CHAPTER XXI.  <b>GOING</b> ABOARD  It was nearly six o’clock, but only grey imperfect misty dawn, when we  <b>drew</b> <b>nigh</b> the wharf.  “ There <b>are</b> some sailors <b>running</b> ahead there, if I <b>see</b> right,” <b>said</b> I to  Queequeg,“ it ca n’t be shadows; she <b>’s</b> off by sunrise, I <b>guess</b>; <b>come</b>  on!”  “ Avast!” <b>cried</b> a voice, whose owner at the same time <b>coming</b> close  behind us, <b>laid</b> a hand upon both our shoulders, and then <b>insinuating</b>  himself between us, <b>stood</b> <b>stooping</b> forward a little, in the uncertain  twilight, strangely <b>peering</b> from Queequeg to me.  It was Elijah.  “ <b>Going</b> aboard?”  “ Hands off, will you,” <b>said</b> I.  “ Lookee here,” <b>said</b> Queequeg, <b>shaking</b> himself,“ <b>go</b>’ way!”  “ Ai nt <b>going</b> aboard, then?”  “ Yes, we are,” <b>said</b> I,“ but what business is that of yours?  <b>Do</b> you  <b>know</b>, Mr. Elijah, that I <b>consider</b> you a little impertinent?”  “ No, no, no; I was n’t aware of that,” <b>said</b> Elijah, slowly and  wonderingly <b>looking</b> from me to Queequeg, with the most unaccountable  glances.  “ Elijah,” <b>said</b> I,“ you will <b>oblige</b> my friend and me by <b>withdrawing</b>.  We</p>
</div>
<p>In these chapters, verbs are displayed in <strong>bold</strong> text. As we can see, these chapters are about the crew of the Pequod and their character interactions. Now let’s explore those chapters with the fewest verbs: chapters 68 and 105.</p>
<div class="cell">
<div class="cell-output-display">
<p>CHAPTER LXVIII.  THE BLANKET  I have <b>given</b> no small attention to that not unvexed subject, the skin  of the whale  .  I have <b>had</b> controversies about it with experienced  whalemen <b>afloat</b>, and <b>learned</b> naturalists ashore.  My original opinion  <b>remains</b> unchanged; but it is only an opinion.  The question is, what and where is the skin of the whale?  Already you  <b>know</b> what his blubber is.  That blubber is something of the consistence  of firm, close- <b>grained</b> beef, but tougher, more elastic and compact,  and  <b>ranges</b> from eight or ten to twelve and fifteen inches in thickness.  Now, however preposterous it may at first <b>seem</b> to <b>talk</b> of any  creature ’s skin as being of that sort of consistence and thickness, yet  in point of fact these are no arguments against such a presumption;  because you can not <b>raise</b> any other dense enveloping layer from the  whale ’s body but that same blubber; and the outermost enveloping layer  of any animal, if reasonably dense, what can that be but the skin?  True, from the unmarred dead body of the whale, you may <b>scrape</b> off with  your hand an infinitely thin, transparent substance, somewhat  <b>resembling</b> the thinnest shreds of isinglass, only it is almost as  flexible and soft as satin; that is, previous to being <b>dried</b>, when it  not only contracts and thickens, but <b>becomes</b> rather hard and brittle.  I</p>
</div>
<div class="cell-output-display">
<p>CHAPTER CV.  DOES THE WHALE ’S MAGNITUDE DIMINISH?—WILL HE <b>PERISH</b>?  Inasmuch, then, as this Leviathan comes <b>floundering</b> down upon us from  the head- waters of the Eternities, it may be fitly <b>inquired</b>, whether,  in the long course of his generations, he has not <b>degenerated</b> from the  original bulk of his sires.  But upon investigation we <b>find</b>, that not only are the whales of the  present day superior in magnitude to those whose fossil remains are  <b>found</b> in the Tertiary system( <b>embracing</b> a distinct geological period  prior to man), but of the whales <b>found</b> in that Tertiary system, those  <b>belonging</b> to its latter formations <b>exceed</b> in size those of its earlier  ones.  Of all the pre - adamite whales yet <b>exhumed</b>, by far the largest is the  Alabama one <b>mentioned</b> in the last chapter, and that was less than  seventy feet in length in the skeleton.  Whereas, we have already <b>seen</b>,  that the tape- measure <b>gives</b> seventy- two feet for the skeleton of a  large sized modern whale.  And I have <b>heard</b>, on whalemen ’s authority,  that Sperm Whales have been <b>captured</b> near a hundred feet long at the  time of capture.  But may it not be, that while the whales of the present hour are an  <b>advance</b> in magnitude upon those of all previous geological periods; may</p>
</div>
</div>
<p>In our analysis, when delving into chapters like 68 and 105, which showcase a lesser frequency of verbs, we notice a focused exposition on the whale’s anatomy and its various aspects. This observation reinforces our hypothesis: chapters with fewer verbs lean more towards a descriptive narrative, concentrating on detailed descriptions and informative content. This style is reflective of expository writing, marked by an emphasis on nouns, adjectives, and non-action verbs, crafted to provide a comprehensive picture to the reader.</p>
<p>Conversely, chapters teeming with verbs often pulsate with narrative energy, moving the story forward through vivid scenes of action and dialogue among characters. This variation in verb usage enlightens us to Melville’s distinct literary styles (narrative vs.&nbsp;descriptive). High verb counts signal narrative character interaction and propel the plot, while a scarcity of verbs typically signifies a shift towards descriptive exposition, offering educational or background information.</p>
<p>Moreover, the usage of parts of speech as a literary device in <em>Moby-Dick</em> is not just a matter of stylistic preference but a deliberate technique to immerse readers into the dual facets of Melville’s world: the tangible, action-driven life aboard the Pequod, and the expansive, contemplative realm of whaling knowledge.</p>
<p>In this context, the Shiny App serves as a powerful tool, empowering users to explore <em>Moby-Dick</em> with an analytical lens. It enables users to seamlessly navigate through the novel, fostering a deeper comprehension of the complex interplay between parts of speech and Melville’s literary styles. By interacting with the app, users can visualize and understand how Melville weaves narrative drive with descriptive depth, thus enriching their appreciation of the novel’s multifaceted composition.</p>
</section>
<section id="limitations-and-moving-further" class="level1">
<h1>Limitations and Moving Further</h1>
<p>While this analysis uncovers some intriguing patterns within <em>Moby-Dick,</em> it’s important to acknowledge certain limitations of the study. Firstly, the data preparation process is conducted externally, requiring some time to complete. Consequently, reproducing the results necessitates access to the <code>anno_moby.Rds</code> file, which might not be readily available. Secondly, the tokenized summaries utilized in this analysis are not included in our standard data package; instead, they are saved as CSV files and subsequently imported into the Shiny App. Should I extend this project, integrating this data directly into the <code>MobyDick</code> package would be a priority to streamline access.</p>
<p>Additionally, there’s an aesthetic issue within the Shiny App where chapter texts are displayed as uninterrupted blocks of text rather than respecting the original paragraph breaks found in <em>Moby-Dick.</em> Correcting this to more accurately reflect the text’s intended format—with appropriate new line breaks for paragraphs—would enhance readability and fidelity to the original work.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="references" class="level1 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-hillway1953essays" class="csl-entry" role="listitem">
Hillway, Tyrus, and Luther S. Mansfield. 1953. <em>Moby-Dick: Centennial Essays</em>. Southern Methodist University Press.
</div>
<div id="ref-melville1851moby" class="csl-entry" role="listitem">
Melville, Herman. 1851. <em>Moby-Dick; or, the Whale</em>. Vol. 1. Harper &amp; Brothers, Publishers, New York.
</div>
<div id="ref-ProjectGutenberg" class="csl-entry" role="listitem">
ProjectGutenberg. 2001. <span>“Moby Dick; or, the Whale by Herman Melville.”</span> <a href="https://www.gutenberg.org/ebooks/2701">https://www.gutenberg.org/ebooks/2701</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>